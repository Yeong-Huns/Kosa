데이터 : 완벽한 개인들 

[1] join  

[2] 사용자 정의 함수

[3] Subquery 

[4] Set opperator 



---
>데이터를 연결하는 방법들
---

  [1] Join

    -


  [2] User-defined function

> 📌예제 1.
```sql
create or replace function uf_dept_dname
(p_deptno dept.deptno%type) 
return dept.dname%type
is
v_dname dept.dname%type;
begin
select dname into v_dname
from dept
where deptno = p_deptno;

return v_dname;
end;
/

show errors
col 부서이름 format a30

select e.empno 사원번호, e.ename 사원이름, e.deptno 부서번호, uf_dept_dname(e.deptno) 부서이름
from emp e;
```
      


> 📌 예제 2.
```sql
create or replace function uf_emp_sum_sal
       (p_deptno emp.deptno%type)
        return number
      is
        v_sum_sal number;
      begin
        select sum(sal) into v_sum_sal
        from emp
        where deptno = p_deptno;
    
        return v_sum_sal;
      end;
      /

      show errors

      col 급여합 format 999,999.99

      select deptno, dname, loc, uf_emp_sum_sal(deptno) 급여합
      from dept;
```

> 📌 예제 3.
```sql
create or replace function uf_emp_total_sal
return number
is
v_total_sal number;
begin
select sum(sal) into v_total_sal
from emp;
    
return v_total_sal;
end;
/

col ratio format a20

select empno,
sal,
uf_emp_total_sal as total_sal, 
to_char(sal/uf_emp_total_sal * 100, '999,999.99') as ratio
from emp;
```

> 📌  예제 4.
```sql
create or replace function uf_emp_ename(p_empno emp.empno%type)
return emp.ename%type
is   
v_ename emp.ename%type;     
begin
select ename into v_ename
from emp
where empno = p_empno;
    
return v_ename;
end;
/

show errors

col 관리자이름 format a30

select empno 사번, ename 사원이름, mgr 관리자사번, uf_emp_ename(mgr) 관리자이름
from emp;
```

  [3] Subquery

> 📌 예제 1. 
```sql
select e.empno 사원번호, e.ename 사원이름, e.deptno 부서번호, (select dname from dept d
                                                                     where deptno = e.deptno) 부서이름
      from emp e;
```

> 📌 예제 2.
```sql
select d.deptno, d.dname, d.loc, (select sum(sal) from emp 
where deptno = d.deptno) 급여합
from dept d;
```

> 📌 예제 3.
```sql
select empno,
sal,
(select sum(sal) 
from emp) as total_sal, 
to_char((sal/(select sum(sal) from emp) * 100), '999,999.99') as ratio
from emp;
```

> 📌 예제 4.
```sql;
select empno 사번, ename 사원이름, mgr 관리자사번, (select ename from emp
where empno = e.mgr) 관리자이름
from emp e;
```

### Set operator
> 📌 예제 1.
```sql
drop table t1 purge;
      drop table t2 purge;

      create table t1
      as
      select empno, ename from emp;       

      create table t2
      as
      select empno, job from emp;
```
      

> 📌 조인으로 해결
```sql
select t1.empno, t1.ename, t2.job
         from t1, t2
         where t1.empno = t2.empno;
```

> 📌 사용자 정의 함수로 해결
```sql 
select empno, ename, null as job from t1
         union all
         select empno, null, job from t2;

         select empno, ename, null as job from t1
         union all
         select empno, null, job from t2
         order by 1, 2, 3;

         select empno, max(ename) as ename, max(job) as job
         from (select empno, ename, null as job from t1
               union all
               select empno, null, job from t2)
         group by empno
         order by empno;
```
