ë°ì´í„° : ì™„ë²½í•œ ê°œì¸ë“¤ 

[1] join  

[2] ì‚¬ìš©ì ì •ì˜ í•¨ìˆ˜

[3] Subquery 

[4] Set opperator 



---
>ë°ì´í„°ë¥¼ ì—°ê²°í•˜ëŠ” ë°©ë²•ë“¤
---

  [1] Join

    -


  [2] User-defined function

> ğŸ“Œì˜ˆì œ 1.
```sql
create or replace function uf_dept_dname
(p_deptno dept.deptno%type) 
return dept.dname%type
is
v_dname dept.dname%type;
begin
select dname into v_dname
from dept
where deptno = p_deptno;

return v_dname;
end;
/

show errors
col ë¶€ì„œì´ë¦„ format a30

select e.empno ì‚¬ì›ë²ˆí˜¸, e.ename ì‚¬ì›ì´ë¦„, e.deptno ë¶€ì„œë²ˆí˜¸, uf_dept_dname(e.deptno) ë¶€ì„œì´ë¦„
from emp e;
```
      


> ğŸ“Œ ì˜ˆì œ 2.
```sql
create or replace function uf_emp_sum_sal
       (p_deptno emp.deptno%type)
        return number
      is
        v_sum_sal number;
      begin
        select sum(sal) into v_sum_sal
        from emp
        where deptno = p_deptno;
    
        return v_sum_sal;
      end;
      /

      show errors

      col ê¸‰ì—¬í•© format 999,999.99

      select deptno, dname, loc, uf_emp_sum_sal(deptno) ê¸‰ì—¬í•©
      from dept;
```

> ğŸ“Œ ì˜ˆì œ 3.
```sql
create or replace function uf_emp_total_sal
return number
is
v_total_sal number;
begin
select sum(sal) into v_total_sal
from emp;
    
return v_total_sal;
end;
/

col ratio format a20

select empno,
sal,
uf_emp_total_sal as total_sal, 
to_char(sal/uf_emp_total_sal * 100, '999,999.99') as ratio
from emp;
```

> ğŸ“Œ  ì˜ˆì œ 4.
```sql
create or replace function uf_emp_ename(p_empno emp.empno%type)
return emp.ename%type
is   
v_ename emp.ename%type;     
begin
select ename into v_ename
from emp
where empno = p_empno;
    
return v_ename;
end;
/

show errors

col ê´€ë¦¬ìì´ë¦„ format a30

select empno ì‚¬ë²ˆ, ename ì‚¬ì›ì´ë¦„, mgr ê´€ë¦¬ìì‚¬ë²ˆ, uf_emp_ename(mgr) ê´€ë¦¬ìì´ë¦„
from emp;
```

  [3] Subquery

> ğŸ“Œ ì˜ˆì œ 1. 
```sql
select e.empno ì‚¬ì›ë²ˆí˜¸, e.ename ì‚¬ì›ì´ë¦„, e.deptno ë¶€ì„œë²ˆí˜¸, (select dname from dept d
                                                                     where deptno = e.deptno) ë¶€ì„œì´ë¦„
      from emp e;
```

> ğŸ“Œ ì˜ˆì œ 2.
```sql
select d.deptno, d.dname, d.loc, (select sum(sal) from emp 
where deptno = d.deptno) ê¸‰ì—¬í•©
from dept d;
```

> ğŸ“Œ ì˜ˆì œ 3.
```sql
select empno,
sal,
(select sum(sal) 
from emp) as total_sal, 
to_char((sal/(select sum(sal) from emp) * 100), '999,999.99') as ratio
from emp;
```

> ğŸ“Œ ì˜ˆì œ 4.
```sql;
select empno ì‚¬ë²ˆ, ename ì‚¬ì›ì´ë¦„, mgr ê´€ë¦¬ìì‚¬ë²ˆ, (select ename from emp
where empno = e.mgr) ê´€ë¦¬ìì´ë¦„
from emp e;
```

### Set operator
> ğŸ“Œ ì˜ˆì œ 1.
```sql
drop table t1 purge;
      drop table t2 purge;

      create table t1
      as
      select empno, ename from emp;       

      create table t2
      as
      select empno, job from emp;
```
      

> ğŸ“Œ ì¡°ì¸ìœ¼ë¡œ í•´ê²°
```sql
select t1.empno, t1.ename, t2.job
         from t1, t2
         where t1.empno = t2.empno;
```

> ğŸ“Œ ì‚¬ìš©ì ì •ì˜ í•¨ìˆ˜ë¡œ í•´ê²°
```sql 
select empno, ename, null as job from t1
         union all
         select empno, null, job from t2;

         select empno, ename, null as job from t1
         union all
         select empno, null, job from t2
         order by 1, 2, 3;

         select empno, max(ename) as ename, max(job) as job
         from (select empno, ename, null as job from t1
               union all
               select empno, null, job from t2)
         group by empno
         order by empno;
```
