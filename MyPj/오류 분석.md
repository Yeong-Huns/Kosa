# 1. í‡´ê·¼ ëˆ„ë½ ì‚¬ìœ ì„œ ì°½ì´ ëœ¨ì§€ ì•ŠëŠ” ë¬¸ì œ 
## 1-1. ìë°” ë¡œê¹…

![[Pasted image 20240516043135.png||360]]

> ğŸ“Œ í‡´ê·¼ ëˆ„ë½ ì‚¬ìœ ì„œ ì•„ë¬´ì°½ë„ ëœ¨ì§€ ì•ŠëŠ” ëª¨ìŠµ

```java
ResponseEntity<List<Approval>> approvalList = ApprovalRepository.getInstance().getMemberStatementOfReason(  
        Approval.builder()  
                .memberId(Main.getSessionKey())  
                .approvalType(2)  
                .approvalDate(date)  
                .build());  
System.out.println("getDeptAnnualLeaves ë„˜ê¸°ëŠ” ê°’ : " + Main.getSessionKey() +" date : " + date);  
System.out.println("ë°›ì•„ì˜¤ëŠ” ì—ëŸ¬ì½”ë“œ ê°’ : " + approvalList.getErrorCode() + " ë©”ì„¸ì§€ : " + approvalList.getErrorMessage());
```


![[Pasted image 20240516043200.png]]

> ğŸ“Œ ë¡œê·¸ë¥¼ ì°ì–´ë³¸ ê²°ê³¼, ì¡°íšŒë˜ëŠ” ë°ì´í„° ì—†ìŒ(list size: 0) ì¸ë°ë„ ë¶ˆêµ¬í•˜ê³  
> ì—ëŸ¬ì½”ë“œ ê°’ì´ 0(ì¡°íšŒë˜ëŠ” ë°ì´í„°ê°€ ìˆìŒ) ë°˜í™˜ë˜ëŠ” ê²ƒì„ í™•ì¸.
> -> ìë°”ë¬¸ì œê°€ ì•„ë‹ˆë¼ê³  í™•ì‹ 

## 1-2. í”„ë¡œì‹œì € í…ŒìŠ¤íŠ¸
```plsql
DECLARE
    p_records       SYS_REFCURSOR;
    p_result_code   NUMBER;
    p_result_message VARCHAR2(400);
BEGIN
    approval_package.get_member_statement_of_reason(
        p_member_id => 3,
        p_approval_type => 2,
        p_year => 2024,
        p_month => 3,
        p_records => p_records,
        p_result_code => p_result_code,
        p_result_message => p_result_message
    );

    DBMS_OUTPUT.PUT_LINE('Result Code: ' || p_result_code);
    DBMS_OUTPUT.PUT_LINE('Result Message: ' || p_result_message);

    LOOP
        DECLARE
            v_comfirm         NUMBER;
            v_content         VARCHAR2(400);
            v_annual_leave_date DATE;
        BEGIN
            FETCH p_records INTO v_comfirm, v_content, v_annual_leave_date;
            EXIT WHEN p_records%NOTFOUND;
            DBMS_OUTPUT.PUT_LINE('Comfirm: ' || v_comfirm);
            DBMS_OUTPUT.PUT_LINE('Content: ' || v_content);
            DBMS_OUTPUT.PUT_LINE('Annual Leave Date: ' || v_annual_leave_date);
        END;
    END LOOP;

    CLOSE p_records;
END;
/
```

> ğŸ“Œ ìë°”ì™€ ë™ë“±í•œ ì¡°ê±´ ì„¸íŒ… (Id : 3, type: 2, year : 2024, month : 3) 

![[Pasted image 20240516043954.png]]

```plsql
DBMS_OUTPUT.PUT_LINE('Comfirm: ' || v_comfirm);
DBMS_OUTPUT.PUT_LINE('Content: ' || v_content);
DBMS_OUTPUT.PUT_LINE('Annual Leave Date: ' || v_annual_leave_date);
```

> ğŸ“Œ ì¡°íšŒê°€ ëë‹¤ë©´ comfirm , content, annual leave dateê°€ ì¶œë ¥ ë˜ì–´ì•¼ í•˜ëŠ”ë°,
> ì¡°íšŒ ê²°ê³¼ê°€ ì¶œë ¥ë˜ì§€ ì•ŠëŠ” ì¤‘

## 1-3. ë°ì´í„° í™•ì¸

![[Pasted image 20240516044451.png]]

> ğŸ“Œ member_id 3 ìœ¼ë¡œ ì¡°íšŒ

![[Pasted image 20240516044437.png]]

> ğŸ“Œ member_id = 3 ì€ ì£„ë‹¤ ì—°ì°¨(approval_type : 1) ê¸°ë¡ë§Œ ê°€ì§€ê³  ìˆë‹¤.
> ì¦‰, í‡´ê·¼ ëˆ„ë½ ì‚¬ìœ ì„œë¥¼ ì¡°íšŒì‹œ, result_codeê°€ 0(ì¡°íšŒì„±ê³µ)ì´ ëœ° ì´ìœ ê°€ ì „í˜€ ì—†ë‹¤.
## 1-4. í”„ë¡œì‹œì € ë¶„ì„
```plsql
-- ë©¤ë²„ë³„ í‡´ê·¼ ëˆ„ë½ ì‚¬ìœ ì„œ ì¡°íšŒ
    procedure get_member_statement_of_reason(
        p_member_id                     in number,
        p_approval_type                 in number,
        p_year                          in number,
        p_month                         in number,
        p_records                       out sys_refcursor,
        p_result_code                   out number,
        p_result_message                out varchar2)
    as
        v_count                         number;
        v_exist                         number;
    begin
        select count(*)
        into v_exist
        from member
        where member_id = p_member_id;

        if v_exist = 0 then
            p_result_code := 2;
            p_result_message := 'ì¡´ì¬í•˜ì§€ ì•ŠëŠ” íšŒì›ì…ë‹ˆë‹¤.';
            open p_records for
                    select cast(null as number) as comfirm,
                        cast(null as varchar2(400)) as content,
                        cast(null as date) as annual_leaves_date
                        from dual;
                        return;

        end if;

        select count(*)
        into v_count
        from approval
        where member_member_id = p_member_id
            and extract(year from annual_leave_date) = p_year
            and extract(month from annual_leave_date) = p_month;
	 -- approval type ê²€ì¦ ëˆ„ë½
        open p_records for
            select comfirm, content, annual_leave_date
            from approval
            where member_member_id = p_member_id
                and approval_type = p_approval_type
                and extract(year from annual_leave_date) = p_year
                and extract(month from annual_leave_date) = p_month;
            if v_count > 0 then
                p_result_code := 0;
                p_result_message := 'í‡´ê·¼ ëˆ„ë½ ì‚¬ìœ ì„œ ì¡°íšŒ ì„±ê³µ';
            else
                p_result_code := 1;
                p_result_message := 'ì¡°íšŒëœ í‡´ê·¼ ëˆ„ë½ ì‚¬ìœ ì„œê°€ ì—†ìŠµë‹ˆë‹¤.';
            end if;
    exception
        when others then
            p_result_code := sqlcode;
            p_result_message := 'error code ì°¸ê³ ';
    end get_member_statement_of_reason;

```

> ğŸ“Œ approval_type ì´ 2ì¸ ê°’ë§Œ ê°€ì ¸ì™€ì•¼ í•˜ëŠ”ë°, `where`ë¬¸ì— approval_typeì„ 
> ê²€ì¦í•˜ëŠ” ì¡°ê±´ì´ ëˆ„ë½ë˜ì–´ìˆë‹¤. 
> ì—°ì°¨ê¸°ë¡ì´ ì¡°íšŒë˜ì—ˆê¸° ë•Œë¬¸ì— `V_count`ê°€ ì¦ê°€í•˜ì˜€ê³ , result_code = 0 , 
> í‡´ê·¼ ëˆ„ë½ ì‚¬ìœ ì„œ ì¡°íšŒ ì„±ê³µì´ ë“¤ì–´ê°€ê³ , 
> ì»¤ì„œì—ì„  `and approval_type = p_approval_type` ë¡œ ìë°”ì—ì„œ ì…ë ¥ëœ
> approval_typeê³¼ ì¼ì¹˜í•˜ëŠ” ê°’(2)ë§Œ ë‹´ì•˜ìœ¼ë‹ˆ ì•„ë¬´ê²ƒë„ ë‹´ê¸°ì§€ ì•Šì€ 
> ë¹ˆì»¤ì„œê°€ ë°˜í™˜ë˜ì—ˆë‹¤. 

# 2. ì—°ì°¨ ìˆ˜ì‹ í•¨ null ë¬¸ì œ
![[Pasted image 20240516045650.png||360]]

> ğŸ“Œ ë‚ ì§œì— nullì´ ë“¤ì–´ì˜¤ê³  ìˆë‹¤.

## 2-1. ìë°”ë¡œê¹… 
![[Pasted image 20240516050159.png]]

> ğŸ“Œ ë§ˆì°¬ê°€ì§€ë¡œ, ì˜ ë„˜ì–´ê°€ê³  ìˆë‹¤. 

## 2-2. í”„ë¡œì‹œì € í…ŒìŠ¤íŠ¸

```plsql
DECLARE
    p_records       SYS_REFCURSOR;
    p_result_code   NUMBER;
    p_result_message VARCHAR2(400);
BEGIN
    approval_package.get_dept_approved_annual_leaves(
        p_member_id => 3,
        p_approval_type => 1,
        p_year => 2024,
        p_month => 5,
        p_records => p_records,
        p_result_code => p_result_code,
        p_result_message => p_result_message
    );

    DBMS_OUTPUT.PUT_LINE('Result Code: ' || p_result_code);
    DBMS_OUTPUT.PUT_LINE('Result Message: ' || p_result_message);

    LOOP
        DECLARE
            v_annual_leaves_id NUMBER;
            v_member_id        NUMBER;
            v_mname            VARCHAR2(100);
            v_comfirm          NUMBER;
            v_content          VARCHAR2(200);
            v_approval_date    DATE;
        BEGIN
            FETCH p_records INTO v_annual_leaves_id, v_member_id, v_mname, v_comfirm, v_content, v_approval_date;
            EXIT WHEN p_records%NOTFOUND;
            DBMS_OUTPUT.PUT_LINE('Annual Leaves ID: ' || v_annual_leaves_id);
            DBMS_OUTPUT.PUT_LINE('Member ID: ' || v_member_id);
            DBMS_OUTPUT.PUT_LINE('Member Name: ' || v_mname);
            DBMS_OUTPUT.PUT_LINE('Confirm: ' || v_comfirm);
            DBMS_OUTPUT.PUT_LINE('Content: ' || v_content);
            DBMS_OUTPUT.PUT_LINE('Approval Date: ' || v_approval_date);
        END;
    END LOOP;

    CLOSE p_records;
END;
/
```

![[Pasted image 20240516050314.png]]

> ğŸ“Œ ê²°ê³¼ : Approval_date : `null` ë¡œ ë“¤ì–´ì˜¤ëŠ” ëª¨ìŠµ

## 2-3. ë°ì´í„° í™•ì¸
![[Pasted image 20240516050526.png]]

> ğŸ“Œ ë”± ë´ë„ Annual_leave_date ëŒ€ì‹  approval_dateë¡œ ì°©ê°í•˜ê³  ë§Œë“ ê±° ê°™ë‹¤. 

## 2-4 í”„ë¡œì‹œì € ë¶„ì„
```plsql
-- ìŠ¹ì¸ëŒ€ê¸°ì¤‘ì¸ ì—°ì°¨ ì¡°íšŒ í”„ë¡œì‹œì €
    procedure get_dept_approved_annual_leaves(
        p_member_id                     in number,
        p_approval_type                 in number,
        p_year                          in number,
        p_month                         in number,
        p_records                       out sys_refcursor,
        p_result_code                   out number,
        p_result_message                out varchar2)
    as
        v_dept_deptno                   number;
        v_count                         number;
    begin
        begin
            select dept_deptno 
            into v_dept_deptno 
            from member 
            where member_id = p_member_id;
        exception
            when no_data_found then
                p_result_code := 2;
                p_result_message := 'ì¡´ì¬í•˜ì§€ ì•ŠëŠ” íšŒì›ì…ë‹ˆë‹¤.';
                open p_records for
                    select cast(null as number) as annual_leaves_id,
                        cast(null as number) as member_id,
                        cast(null as varchar2(100)) as mname,
                        cast(null as number) as comfirm,
                        cast(null as varchar2(200)) as content,
                        cast(null as date) as approval_date
                        from dual
                return;
        end;

        select count(*)
        into v_count
        from approval a
        join member m on a.member_member_id = m.member_id
        where m.dept_deptno = v_dept_deptno
            and a.approval_type = p_approval_type
            and comfirm = 2
            and extract(year from a.annual_leave_date) = p_year
            and extract(month from a.annual_leave_date) = p_month;
        open p_records for
            select annual_leaves_id, member_id, mname, comfirm, content, approval_date 
            from dept_approval_view
            where dept_deptno = v_dept_deptno
                and approval_type = p_approval_type
                and comfirm = 2
                and extract(year from annual_leave_date) = p_year
                and extract(month from annual_leave_date) = p_month;
            if v_count > 0 then
                p_result_code := 0;
                p_result_message := 'í•´ë‹¹ ë…„/ì›” ë¶€ì„œì› ì—°ì°¨ ì¡°íšŒ ì„±ê³µ';
            else
                p_result_code := 1;
                p_result_message := 'í•´ë‹¹ ë…„/ì›” ì¡°íšŒëœ ë¶€ì„œì› ì—°ì°¨ê°€ ì—†ìŠµë‹ˆë‹¤.';
            end if;
        exception
            when no_data_found then
                p_result_code := 2;
                p_result_message := 'NO_DATA_FOUND';
            when others then
                p_result_code := sqlcode;
                p_result_message := 'error code ì°¸ê³ ';
end get_dept_approved_annual_leaves;

```

> ğŸ“Œ ì—­ì‹œë‚˜ ì»¤ì„œê°€ `Annual_leave_date` ëŒ€ì‹  `approval_date` ë¥¼ ë‹´ê³ ìˆë‹¤.


# 3.ê²°ì¬í•¨ ì‹ ì²­ì‹œ í™”ë©´ í”„ë¦¬ì§• ë¬¸ì œ
> ğŸ“Œ ì—­ì‹œë‚˜ ì˜ˆìƒëŒ€ë¡œ Error codeê°€ 2ê°€ ë‚ ì•„ì˜¤ë©´ IllegalArgumentExceptionìœ¼ë¡œ 
> ì¤‘ë‹¨ ì‹œí‚¤ëŠ”ê²Œ ë¬¸ì œê°€ ë˜ì—ˆë‹¤. 

```java
try{  
switch (approvalType) {  
    case 1 -> {  
        ResponseEntity<Void> response = ApprovalRepository.getInstance().resisterApproval(  
                Approval.builder()  
                        .memberId(Main.getSessionKey())  
                        .content(reasonTextArea.getText())  
                        .approvalDate(localDate)  
                        .build());  
  
        response.showDialogs();  
    }  
    case 2 -> {  
        ResponseEntity<Void> response = ApprovalRepository.getInstance().insertStatementReason(  
                Approval.builder()  
                        .memberId(Main.getSessionKey())  
                        .content(reasonTextArea.getText())  
                        .approvalDate(localDate)  
                        .build());  
  
        response.showDialogs();  
    }  
}  
} finally {  
    UIController.getInstance().getApprovalView().getApprovalDetail().removeAll();  
    UIController.getInstance().getApprovalView().getApprovalDetail().initUIComponents();  
    UIController.getInstance().getApprovalView().getApprovalDetail().revalidate();  
    UIController.getInstance().getApprovalView().getApprovalDetail().repaint();  
    System.out.println("After switch:");  
    System.out.println("ApprovalType: " + approvalType);  
}
```

> ë§Œì•½ `switch - case`ë¬¸ì—ì„œ Error-code 2 ê°€ ë°œìƒí•˜ë©´, ìë™ìœ¼ë¡œ IllegalArgumentExceptionì´ í˜¸ì¶œë˜ë©´ì„œ, ì•„ë˜ìˆëŠ” ìƒˆë¡œê³ ì¹¨ ë¡œì§ì´ ì‹¤í–‰ë˜ì§€ ì•ŠëŠ”ë‹¤.
> finally êµ¬ë¬¸ì„ ì‚¬ìš©í•˜ì—¬ ì—ëŸ¬ê°€ ë°œìƒí•˜ì—¬ë„ ë°˜ë“œì‹œ ì‹¤í–‰í•˜ëŠ”ê±¸ë¡œ í•´ê²°




